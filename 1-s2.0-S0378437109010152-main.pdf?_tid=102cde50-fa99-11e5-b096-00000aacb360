<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="initial-scale=1">


<title>Université Laval - Authentification</title>
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css' media="all" />
<link rel="stylesheet" type="text/css" href="css/sso_style-appM.css" media="screen" />
<!--[if lte IE 8]>
    <link rel="stylesheet" type="text/css" href="css/sso_ie8.css">
    <![endif]-->
<!-- <link rel="shortcut icon" href="https://www.bsi.ulaval.ca/templates/bsi/common/favicon.ico" /> -->
<!--  <link rel="icon" type="image/vnd.microsoft.icon" href="https://www.bsi.ulaval.ca/templates/bsi/common/favicon.ico" /> -->
<script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.js"></script>
<script type="text/javascript" src="js/sso_actions-appM.js"></script>

<script type="text/javascript" src="/public/include/js/common.js" ></script>
<script type="text/javascript">
<!--
/////////////////////////////////////////////////////////////////////////
// function to return the customized screen when session expiration
// is detected on the client-side
/////////////////////////////////////////////////////////////////////////
function SessionExpired_CustomizedScreenGet()
{
  return '<br><h3>Session expirée/ Timeout</h3><br>En raison de l\'inactivité de l\'utilisateur, votre session a expiré. Cliquez sur le lien suivant pour lancer une nouvelle session.<br><br><table id="IHoptions"><tr><td><a href="[SESSION_RESTART_URL]" class="option"><img src="/public/images/sq-positive.gif" ></a><a href="[SESSION_RESTART_URL]">Start a new session (Lancer une nouvelle session)</a></td></tr></table>';
}
// ajout de redirection dla 9sec
//window.setTimeout(function() {window.location.href = 'https://auth-app.ulaval-at.ca/timeout.html';}, 299000);
var globalRestartOnSubmit = false;

function sessionTimedOut()
{
    // restart session automatically upon "submit" for edge-like clients if logon form is compatibile
    if ((undefined != window.external.WebLogonResetSession) && (null != globalInputs)) {
       globalRestartOnSubmit = true;
    }
    else {
       // display session expired msg for non-compatible forms or
       // non-edge clients
       showSplashLayer("MessageDIV", SessionExpired_CustomizedScreenGet());
    }
}

/**
 * Place the focus and init the form fields
 */

if(self != top) { top.location = self.location; }
window.onerror=function(){ return function(){ return; } }

//--------------------------------------------------------------------
var doNotAutoSubmit = false;

var globalFormId = 'auth_form';
var globalTableId = 'credentials_table';
var globalSubmitTrId = 'submit_row';

var globalSavePasswordCheckbox = null;
var globalInputs = null;

// compatibily function, works only with input[0] text username and input[1] text password
function getFormCompatibility()
{
    // find from
    var form = document.getElementById( globalFormId );
    if( form == null ){
        return null;
    }

    // check if form suites
    var inputs = [];
    var inputsTemp = form.getElementsByTagName("input");
    // filter submit, reset, hidden and little green men
    for( var i=0; i<inputsTemp.length; i++ ){
        if( inputsTemp[i].type == "text" || inputsTemp[i].type == "password" ||  inputsTemp[i].type == "checkbox" ){
            inputs[ inputs.length ] = inputsTemp[i]
        }
    }
    // is it compatible
    if( inputs.length != 2 || inputs[0].type != "text" || inputs[0].name != "username" || inputs[1].type != "password" || inputs[1].name != "password" ){
        return null;
    }

    return inputs;
}

function OnLoad()
{
    // check if form suites
    var form = document.getElementById( globalFormId );
    if( form == null ){
        return;
    }

    // check if form suites
    var inputs = form.getElementsByTagName("input");
    // filter submit, reset, hidden and little green men
    for( var i=0; i<inputs.length; i++ ){
        if( ( inputs[i].type == "text" || inputs[i].type == "password" ) && inputs[i].value == "" ){
            inputs[i].focus();
            if (inputs[i].type == "password") {
                window.setTimeout( function(elem){ return function(){ elem.blur(); elem.focus(); } }(inputs[i]) , 266 );
            }
            return;

        }
    }
}

// support for autologon from Client API
function checkExternalAddCheckbox()
{
    var checkbox_txt = 'Sauvegarder le mot de passe';

    if( globalInputs == null ){
        return;
    }

    // find form
    var form = document.getElementById( globalFormId );
    if( form == null ){
        return;
    }

    // find table
    var table = document.getElementById( globalTableId );
    if( table == null ){
        return;
    }

    // find tr
    var submitTr = document.getElementById( globalSubmitTrId );
    if( submitTr == null ){
        return;
    }

    try {
    	if(window.external){
            // push values
			if( window.external.WebLogonUserName && globalInputs[0].value == ""){
				globalInputs[0].value = window.external.WebLogonUserName;
            }
			if(window.external.WebLogonPassword && globalInputs[1].value == ""){
				globalInputs[1].value = window.external.WebLogonPassword;
            }

            // push data to cells
			if(window.external.WebLogonSavePasswordAvailable){
                // right - text

                // create cells
                var newTr = table.insertRow( submitTr.rowIndex );
                var leftTd = newTr.insertCell( 0 );
                var rightTd = newTr.insertCell( 1 );

                leftTd.className = "credentials_table_label_cell";
                rightTd.className = "credentials_table_field_cell credentials_table_field_checkbox_fix";

                rightTd.innerHTML = checkbox_txt;
                // left - checkbox
                globalSavePasswordCheckbox = document.createElement("input");
                globalSavePasswordCheckbox.type = "checkbox";
                globalSavePasswordCheckbox.className = "credentials_input_checkbox";
                globalSavePasswordCheckbox.value = 1;
                globalSavePasswordCheckbox = leftTd.appendChild( globalSavePasswordCheckbox );
                globalSavePasswordCheckbox.checked = window.external.WebLogonSavePasswordChecked;
                if( globalSavePasswordCheckbox.autocomplete ) {
                    globalSavePasswordCheckbox.autocomplete = "off";
                }
            }

            // autosubmit check
            if(window.external.WebLogonAutoLogon && !doNotAutoSubmit){
                doAutoSubmit = true;
                form.onsubmit();
                form.submit();
                return;
            }
        }
    } catch (e) { }
}

function disableSubmit(form)
{
    // disable!
    var inputs = form.getElementsByTagName( "input" );
    for( var i=0; i<inputs.length; i++ ){
        if( inputs[i].type == "submit" || inputs[i].type == "reset" ){
            inputs[i].disabled = true;
        }
    }

    return true;
}

function OnSubmit()
{
    // find form
    var form = document.getElementById( globalFormId );
    if( form == null ){
        return;
    }

    if( globalInputs == null ){
        return;
    }

    try{
        if( window.external ){
            if( undefined != window.external.WebLogonUserName ){
                window.external.WebLogonUserName = globalInputs[0].value;
            }

            if( undefined != window.external.WebLogonPassword ){
                window.external.WebLogonPassword = globalInputs[1].value;
            }

            if( undefined != window.external.WebLogonSavePasswordChecked && null != globalSavePasswordCheckbox ){
                window.external.WebLogonSavePasswordChecked = globalSavePasswordCheckbox.checked;
            }

        }
    } catch(e) { }

    return;
}

function verifyNewPassword()
{
    var form = document.getElementById( globalFormId );
    if( form == null ){
        return true;
    }

    var inputs = form.getElementsByTagName("input");
    if( inputs.length >= 2 && inputs[0].name == "_F5_challenge" && inputs[0].type == "password" && inputs[1].name == "_F5_verify_password" && inputs[1].type == "password" ){
        if( inputs[0].value != inputs[1].value ){
            alert("Le mot de passe et la confirmation de ce mot de passe ne correspondent pas.");
            inputs[0].focus();
            return false;
        } else {
            // Not sending the second field.
            inputs[1].disabled = true;
        }
    }
    return true;
}

function masterSubmit(form)
{
    if( !verifyNewPassword() /* || ... */){
        return false;
    }

    OnSubmit(); // this required by edge

    if (globalRestartOnSubmit) {
        try {
            window.external.WebLogonAutoLogon = (("" != globalInputs[0].value) && ("" != globalInputs[1].value));
        }
        catch (e) {}
        // restart session
        window.external.WebLogonResetSession();
        return false;
    }

    disableSubmit(form);
    return true;
}

/*
 * Cette méthode permet de modifier l'URL affiché à l'utilisateur pour le rendre 'bookmarquable'.
 * Elle utilise la valeur du cookie 'url_origine' afin de mettre l'URL d'origine dans l'URL.
 *
 * Ceci ne peut pas fonctionner dans IE 8 ou 9.
 */
function modifierURL() {
    if (history.replaceState) {
        var urlOrigine = get_cookie("url_origine");
        history.replaceState(null, window.titre, "/authentification.html?urlorigine=" + urlOrigine);
       /* history.replaceState(null, window.titre, "/authentification.html); */
    }
}
String.prototype.endsWith = function(str) {return (this.match(str+"$")==str)}
/*
 * Cette fonction valide l'usager pour la gestion de mot de passe
*/
function valideIDUL() {
    var usertemp = /ut[0-9][0-9]/ig;

    var usermail = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

    var idul = document.getElementById("input_1").value;
    var div = document.getElementById("no_user");
    if(idul == ""){
        window.location.href ="/motdepasseoublie.html";
    } else if(idul.match(usertemp)){
      window.location.href = "https://www.portaildescours.ulaval.ca/portail/gestiondumotdepasse";

	} else if(idul.endsWith("ulaval.ca")){

       window.location.href = "https://oraweb.ulaval.ca/pls/prv/prv_changement_nip_sau.changer_nip_certification_1?identifiant=";

    } else if(idul.match(usermail)){
      window.location.href = "https://www.portaildescours.ulaval.ca/portail/gestiondumotdepasse?typeUtilisateur=NCERT&id=" + idul;

    }  else if (idul.length > 16) {

       window.location.href = "https://oraweb.ulaval.ca/pls/prv/prv_changement_nip_sau.changer_nip_certification_1?identifiant=";

    }  else {

	  window.location.href = "https://oraweb.ulaval.ca/pls/prv/prv_changement_nip_sau.changer_nip_certification_1?identifiant=" + idul;


	}
}
function CustomAlert(){
    this.render = function(dialog){
		var dialogoverlay = document.getElementById('dialogoverlay');
		dialogoverlay.style.display = "block";

	}
	this.ok = function(){
        location.reload(false);
	}
}
var Alert = new CustomAlert();
/*
* Cette fonction permet de rafraichir la page pour éviter l'erreur 20 après l'expiration du timeout de la policy
*/

setTimeout(function () { Alert.render(); }, 298000);

modifierURL();

//-->
</script>
</head>


<body onload="OnLoad()">

<div class="sau-entete">
        <div class="ul-bandes">
            <div class="ul-bande-or"></div>
        </div>

        <div class="sau-entete-corps sau-gabarit">
            <div class="ul-bandes">
                <div class="ul-bande-or"></div>
            </div>

            <a class="sau-entete-logo" href="http://www.ulaval.ca" alt="Université Laval" title="Université Laval">
                <span>Université Laval</span>
            </a>

       </div>

    </div>


      <div class="sau-gabarit">

        <div class="sau-boite">
            <div class="sau-boite-corps">
                <div style="position:relative;">
                    <h1 class="clearfix">
                        Connexion 
                    </h1>
                   <!-- <div id="sau-infobulle-connexion" class="sau-message-information sau-message-infobulle">
                        <div class="sau-message-corps">
                           <p>Avec une seule connexion vous pourrez bientôt accéder à une gamme de services en ligne, tels que : votre boîte courriel et le Portail des cours. </p>
                        </div>
                    </div> -->
                </div>

				     <div id="zoneService">


					<!-- MESSAGES -- DEBUT -->
									<!--
					<div class="message">
						<div class="picto"></div>
						<div class="text"><h4>Votre connexion est expirée.</h4>Vous devez vous reconnecter pour continuer.</div>
					</div>
					-->
					<!-- MESSAGES -- FIN -->
				    			    			<!-- FORMULAIRE -- DEBUT -->
                                                	<form id="auth_form" name="e1" method="post" action="/my.policy" onsubmit="javascript: return masterSubmit(this);" autocomplete="off">
                                                			<input type="hidden" name="rememberMe" id="rememberMe" value="0" />
                                                			 <div class="mpo-super-espacement-bas" style="position:relative;">
                                                                <label>Identifiant</label>
                                                			  <a id="sau-infobulle-user-icone" href class="sau-aide-icone" tabindex="5">
                                                                          <span class="mpo-icone-question-mark-o bulleInfoIdentifiant"></span>
                                                                      </a>
                                                					<div id="sau-infobulle-user" class="sau-message-information sau-message-aide">
                                                                      <div class="sau-message-corps">
                                                                          <h3 class="mpo-super-espacement-bas">Quel identifiant utiliser pour me connecter?</h3>
                                                
                                                                          <h6>Étudiant ou membre du personnel de l’Université Laval</h6>
                                                                          <p class="mpo-super-espacement-bas">Votre identifiant est votre <strong>IDUL</strong>. Celui-ci est composé de cinq lettres, générées à partir de
                                                                          votre prénom et de votre nom, suivies généralement d'un à trois chiffres.</p>
                                                
                                                                          <h6>Utilisateur temporaire</h6>
                                                                          <p class="mpo-super-espacement-bas">Si vous disposez d’un compte d’accès temporaire au Portail des cours, votre identifiant vous a
                                                                          été envoyé par courriel à la création du compte. Il débute par <strong>« UT »</strong> et est suivi de six
                                                                          chiffres.</p>
                                                
                                                                          <h6>Participant au MOOC</h6>
                                                                          <p>Si vous avez créé un compte pour vous inscrire à un MOOC, votre identifiant est le <strong>courriel</strong>
                                                                          saisi lors de la création du compte. Si vous vous êtes inscrit au MOOC avec votre IDUL,
                                                                          utilisez plutôt ce dernier pour vous connecter.</p>
                                                
                                                                      </div>
                                                                  </div>
                                                			  <div class="clearfix sau-champ-avec-icone">
                                                						
                                                                      <div class="mpo-champ">
                                                			<input class="mpo-champ-champ" type="text" name="username" value="" id="input_1" autocomplete="off" autocapitalize="off" tabindex=1/>
                                                			        </div>
                                                                     
                                                
                                                                  </div>
                                                				
                                                					<a href="https://www.dti.ulaval.ca/besoin-dassistance/centre-de-services-dti" tabindex="6">
                                                
                                                                      Identifiant oublié?
                                                                  </a>
                                                			</div>
                                                
                                                			<label>Mot de passe</label>
                                                
                                                  <div class="clearfix sau-champ-avec-icone">
                                                              <div class="mpo-champ">
                                                			<input class="mpo-champ-champ" type="password" name="password" value="" id="input_2" autocomplete="off" autocapitalize="off" tabindex="2"/>
                                                
                                                			</div>
                                                </div>
                                                			 <a onclick="valideIDUL()" href="#" tabindex="7">Mot de passe oublié?</a>
                                                			<!-- <div class="check">Retenir mon identifiant (IDUL)</div> -->
                                                
                                                			 <p>
                                                			<input class="mpo-bouton mpo-bouton-primaire" type="submit" id="btnSubmit" name="btnSubmit" class="btnSubmit" value="Se connecter" tabindex="3"/>
                                                
                                                			</p>
                                                
                                                			<input type=hidden name="vhost" value="standard">
                                                
                                                		</form>
                                                		<!-- FORMULAIRE -- FIN -->
				</div>

                <div id="zoneSecurite">
                    <h1>Protégez vos données</h1>
                    <p>Pour protéger les données auxquelles vous avez accès,
                    assurez-vous de <strong>toujours vous déconnecter de vos applications et de fermer votre
                    navigateur</strong> avant de vous éloigner de votre poste de travail.</p>
                </div>


            </div>
        </div>

    </div>


    <div class="sau-pied">
        <div class="sau-gabarit">
        <p>
            © <span id="sau-pied-annee"></span> <a href="http://www.ulaval.ca">Université Laval</a> <span id="sau-pied-separation">Tous droits réservés. | <a href="https://www.bsi.ulaval.ca/cms/site/bsi/page111896.html">Avis&nbsp;légal</a></span>
        </p>
        </div>
    </div>

<script language="javascript"><!--//
        globalInputs = getFormCompatibility();
        checkExternalAddCheckbox();
        window.setTimeout("sessionTimeoutCheck(sessionTimedOut)", globalTimoutInterval);

        function dontChangePasswordClick(){
            var checkbox = document.getElementById("dont_change_password_checkbox");
            var password = document.getElementById("input_1");
            var verify = document.getElementById("input_2");
            if( checkbox.checked ){
                password.value = "";
                password.disabled = true;
                verify.value = "";
                verify.disabled = true;
            }else{
                password.disabled = false;
                verify.disabled = false;
            }
        }
        $('#MessageErreur').hide();
        $('#MessageExpiration').hide();
-->
</script>





<!-- Dialogue inactivité -->

<div id="dialogoverlay">
        <div class="shadow"></div>
        <div class="corps">
            <div class="contenu">
                <div id="dialogboxhead">Période d’inactivité trop longue</div>
                <div id="dialogboxbody">Cette page doit être actualisée si vous désirez vous connecter.</div>
                <div id="dialogboxfoot"><button class="btnSubmit" onclick="Alert.ok()">Actualiser</button></div>
            </div>
        </div>
    </div>

</body>

</html>
